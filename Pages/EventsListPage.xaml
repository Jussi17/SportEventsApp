<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SportEventsApp.Pages.EventsListPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Name="EventsPageRoot"
    Title="Tapahtumat"
    Padding="10"
    SizeChanged="OnPageSizeChanged">

    <Grid
        x:Name="MainGrid"
        ColumnSpacing="10"
        RowSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  Tulevat/Menneet napit  -->
            <RowDefinition Height="*" />
            <!--  Lajit  -->
            <RowDefinition Height="*" />
            <!--  Tapahtumat  -->
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350" />
            <!--  Lajit  -->
            <ColumnDefinition Width="*" />
            <!--  Tapahtumat  -->
        </Grid.ColumnDefinitions>

        <!--  Tulevat / Menneet napit  -->
        <StackLayout
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            HorizontalOptions="Fill"
            Orientation="Horizontal"
            Spacing="10">

            <Button
                x:Name="UpcomingButton"
                BackgroundColor="Blue"
                Clicked="OnUpcomingClicked"
                HeightRequest="50"
                HorizontalOptions="Fill"
                Text="Tulevat"
                TextColor="White">
                <Button.GestureRecognizers>
                    <PointerGestureRecognizer PointerEntered="OnButtonPointerEntered" PointerExited="OnButtonPointerExited" />
                </Button.GestureRecognizers>
            </Button>

            <Button
                x:Name="PastButton"
                BackgroundColor="LightGray"
                Clicked="OnPastClicked"
                HeightRequest="50"
                HorizontalOptions="Fill"
                Text="Menneet"
                TextColor="Black">
                <Button.GestureRecognizers>
                    <PointerGestureRecognizer PointerEntered="OnButtonPointerEntered" PointerExited="OnButtonPointerExited" />
                </Button.GestureRecognizers>
            </Button>
        </StackLayout>

        <!--  Lajilista  -->
        <CollectionView
            x:Name="SportsList"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            SelectionChanged="OnSportSelected"
            SelectionMode="Single">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame
                        Margin="5"
                        Padding="5"
                        BackgroundColor="Blue"
                        BorderColor="DarkBlue"
                        CornerRadius="5"
                        HasShadow="False">
                        <Grid>
                            <Grid.GestureRecognizers>
                                <PointerGestureRecognizer PointerEntered="OnSportPointerEntered" PointerExited="OnSportPointerExited" />
                            </Grid.GestureRecognizers>
                            <Label
                                FontSize="14"
                                HorizontalOptions="Center"
                                Text="{Binding}"
                                TextColor="White"
                                VerticalOptions="Center" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!--  Tapahtumat  -->
        <CollectionView
            x:Name="EventsList"
            Grid.Row="2"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            ItemsSource="{Binding FilteredEvents}"
            SelectionMode="None">
            <CollectionView.ItemsLayout>
                <GridItemsLayout
                    x:Name="EventsItemsLayout"
                    HorizontalItemSpacing="10"
                    Orientation="Vertical"
                    Span="2"
                    VerticalItemSpacing="10" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame
                        Margin="5"
                        Padding="10"
                        BackgroundColor="{AppThemeBinding Light=White,
                                                          Dark=#333333}"
                        BorderColor="LightGray"
                        CornerRadius="10">
                        <Grid>
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnEventTapped" />
                                <PointerGestureRecognizer PointerEntered="OnEventPointerEntered" PointerExited="OnEventPointerExited" />
                            </Grid.GestureRecognizers>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!--  Tapahtuman tiedot  -->
                            <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="{Binding Sport}" />
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="18"
                                    Text="{Binding Name}" />
                                <Label FontSize="14" Text="{Binding Date, StringFormat='⏰ {0:dd.MM.yyyy HH:mm}'}" />
                                <Label FontSize="14" Text="{Binding Location, StringFormat='📍 {0}'}" />
                                <Label FontSize="14" Text="{Binding Channel, StringFormat='📺 {0}'}" />
                            </VerticalStackLayout>

                            <!--  Kellonappi  -->
                            <Button
                                Grid.Row="0"
                                Grid.Column="1"
                                BackgroundColor="Transparent"
                                Clicked="OnClockClicked"
                                HeightRequest="28"
                                HorizontalOptions="End"
                                ImageSource="{Binding BellImage}"
                                IsVisible="{Binding NotifyVisible}"
                                VerticalOptions="Start"
                                WidthRequest="28" />

                            <!--  Admin-napit  -->
                            <HorizontalStackLayout
                                Grid.Row="1"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Margin="0,10,0,0"
                                IsVisible="{Binding IsAdminVisible}"
                                Spacing="10">
                                <Button
                                    BackgroundColor="Orange"
                                    Clicked="OnEditEventClicked"
                                    FontSize="12"
                                    Text="Muokkaa">
                                    <Button.GestureRecognizers>
                                        <PointerGestureRecognizer PointerEntered="OnButtonPointerEntered" PointerExited="OnButtonPointerExited" />
                                    </Button.GestureRecognizers>
                                </Button>
                                <Button
                                    BackgroundColor="LightCoral"
                                    Clicked="OnDeleteEventClicked"
                                    FontSize="12"
                                    Text="Poista">
                                    <Button.GestureRecognizers>
                                        <PointerGestureRecognizer PointerEntered="OnButtonPointerEntered" PointerExited="OnButtonPointerExited" />
                                    </Button.GestureRecognizers>
                                </Button>
                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!--  VisualStateManager responsiivisuuteen  -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="DeviceStates">
                <VisualState x:Name="Phone">
                    <VisualState.Setters>
                        <Setter TargetName="SportsList" Property="Grid.ColumnSpan" Value="2" />
                        <Setter TargetName="EventsList" Property="Grid.Row" Value="2" />
                        <Setter TargetName="EventsList" Property="Grid.Column" Value="0" />
                        <Setter TargetName="EventsList" Property="Grid.ColumnSpan" Value="2" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="Tablet">
                    <VisualState.Setters>
                        <Setter TargetName="SportsList" Property="Grid.ColumnSpan" Value="1" />
                        <Setter TargetName="EventsList" Property="Grid.Row" Value="1" />
                        <Setter TargetName="EventsList" Property="Grid.Column" Value="1" />
                        <Setter TargetName="EventsList" Property="Grid.ColumnSpan" Value="1" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</ContentPage>